<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registration / Payment</title>
  <link rel="stylesheet" href="pay.css" />
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database-compat.js"></script>
</head>
<body>

  <div class="container">
    <h1>Free Fire Tournament Registration</h1>
    <form id="registrationForm">
      <input type="text" name="name" placeholder="Player Name" required />
      <input type="text" name="email" placeholder="Email" required />
      <input type="text" name="game_uid" placeholder="Game UID" required />
      <input type="text" name="utr" placeholder="Transaction UTR" required />
      <input type="number" name="amount" placeholder="Amount Paid" required />
      <input type="date" name="txn_date" required />
      <input type="time" name="txn_time" required />
      <input type="text" name="payer_name" placeholder="Payer Name" required />
      <button type="submit">Register</button>
    </form>

    <div id="successPopup" style="display:none; color: green; margin-top: 20px;">
      ‚úÖ Registration successful!
    </div>
  </div>

  <script>
    // ‚úÖ Firebase Configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DB_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ‚úÖ Form Submit Logic
    const form = document.getElementById("registrationForm");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const entry = {
        name: formData.get("name"),
        email: formData.get("email"),
        game_uid: formData.get("game_uid"),
        utr: formData.get("utr"),
        amount: formData.get("amount"),
        txn_date: formData.get("txn_date"),
        txn_time: formData.get("txn_time"),
        payer_name: formData.get("payer_name"),
        timestamp: new Date().toISOString()
      };

      try {
        // üîÑ Store to Firebase
        await db.ref("registrations").push(entry);

        // ‚úâÔ∏è Send Email via W3Forms
        await fetch("https://api.w3forms.com/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            access_key: "cbc101c3-52ae-47e6-9177-dff4103101f0",
            subject: "New Tournament Registration",
            name: entry.name,
            email: entry.email,
            message: `
              Game UID: ${entry.game_uid}
              UTR: ${entry.utr}
              Amount: ${entry.amount}
              Date: ${entry.txn_date}
              Time: ${entry.txn_time}
              Payer: ${entry.payer_name}
            `
          })
        });

        // ‚úÖ Show Success
        form.reset();
        document.getElementById("successPopup").style.display = "block";
        setTimeout(() => {
          document.getElementById("successPopup").style.display = "none";
        }, 5000);
      } catch (err) {
        console.error("Registration failed:", err);
        alert("‚ùå Something went wrong. Try again.");
      }
    });
  </script>
</body>
</html>
